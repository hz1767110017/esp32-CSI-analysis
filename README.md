# esp32-CSI-analysis

The main purpose of this project is to show how to analysis CSI_DATA on Windows10 with log files generated by NodeMCU-ESP32-S. We will focus on applications in indoor positioning and behavior recognition through Machine Learning, Deep Learning and other algorithms.

## Introduction

### Step 1: How to get csi raw data by using ESP32

You can visit [esp-csi](https://github.com/espressif/esp-csi). This repository has all the process for csi collection. Please pay attention to the version of esp-idf, this project can only run on a special version. You can checkout the problem [WDT Reset](https://github.com/espressif/esp-csi/issues/2) for help.
Also, you can check from the dictionory [docs](./docs), which has more detailed CSI acquisition steps. However, the serial port output of the development board will have some unpredictable bugs when collecting csi data. If possible, you could use other serial port tools instead.


### Step 2: Run extract_csidata.py

1. Extract CSI data from ".txt" and save it into ".csv".

    Before you use it, you should prepare correct device log file and the file should contain some strings begin with "CSI_DATA".

    ```bash
    $ python extract_csidata.py --src reference_data/log.console_test.20210713102040.txt
    ```

    if you want to save csv to another file, you can run like this.

    ```bash
    $ python extract_csidata.py --src reference_data/log.console_test.20210713102040.txt --dst csi_data.csv
    Saved CSI data to csi_data.csv
    ```

    The output file would be look like this:

    ```csv
        type	id	mac	rssi	rate	sig_mode	mcs	bandwidth	smoothing	not_sounding	aggregation	stbc	fec_coding	sgi	noise_floor	ampdu_cnt	channel	secondary_channel	local_timestamp	ant	sig_len	rx_state	len	first_word	data
        CSI_DATA	0	94:3c:c6:0f:9a:61	-46	11	1	7	1	1	1	0	0	0	0	-90	0	13	2	51299134	0	66	0	384	1	[66,32,4,0,0,0,0,0,0,0,-1,3,0,12,0,12,0,12,1,12,1,12,1,11,2,11,2,11,2,11,3,11,3,11,3,10,3,10,4,10,4,10,4,10,5,10,5,10,5,10,6,9,6,9,6,9,7,9,7,9,7,9,8,9,4,4,9,8,9,9,9,9,10,9,10,9,10,9,11,9,11,10,11,10,11,10,11,10,11,11,11,11,11,11,11,12,11,12,11,12,11,13,11,13,11,13,10,14,10,14,9,15,8,15,7,15,7,16,1,4,0,0,0,0,0,0,0,0,-1,1,-1,4,0,24,0,24,0,24,1,24,0,23,1,23,1,23,2,22,3,22,3,21,4,21,4,21,5,21,6,21,6,20,7,20,8,20,8,19,9,19,9,19,10,19,11,18,11,18,12,18,12,18,13,17,14,17,15,17,15,17,16,16,17,16,17,16,18,16,18,16,19,17,20,17,20,17,21,17,21,18,22,19,22,19,22,19,22,20,22,20,22,21,22,22,22,22,22,23,21,24,21,25,21,25,20,26,19,27,18,27,17,28,15,29,14,29,4,9,0,1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,-2,-2,-7,-10,-19,-32,-19,-33,-18,-33,-17,-33,-16,-33,-15,-32,-14,-32,-14,-32,-13,-31,-13,-31,-12,-31,-12,-30,-12,-29,-11,-29,-11,-28,-11,-27,-11,-27,-11,-26,-11,-25,-11,-24,-11,-23,-11,-23,-11,-22,-11,-21,-12,-21,-12,-20,-13,-18,-13,-18,-13,-17,-14,-17,-14,-16,-15,-16,-16,-15,-16,-14,-16,-13,-17,-13,-17,-12,-18,-12,-18,-11,-18,-10,-19,-9,-19,-8,-20,-8,-20,-7,-21,-7,-21,-6,-22,-5,-22,-5,-23,-4,-23,-4,-24,-3,-24,-3,-24,-2,-25,-1,-25,-1,-26,0,-26,0,-5,-1]
        CSI_DATA	1	94:3c:c6:0f:9a:61	-46	11	1	7	1	1	1	1	0	0	0	-90	1	13	2	51464162	0	67	0	384	1	[67,48,4,0,0,0,0,0,0,0,-1,3,-3,12,-2,12,-1,12,-1,12,0,12,0,12,0,11,0,11,1,11,1,11,2,11,2,11,3,11,3,10,3,10,4,10,4,10,5,10,5,10,6,10,6,10,6,10,7,9,7,9,8,9,8,9,4,4,9,9,10,9,10,9,10,9,11,10,11,10,12,10,12,11,12,11,12,11,12,12,12,12,12,12,12,12,12,13,12,13,12,14,12,14,12,14,12,15,11,15,11,16,10,17,9,17,8,17,8,17,2,4,0,0,0,0,0,0,0,0,-1,-1,-2,3,-7,25,-6,24,-5,24,-5,24,-5,24,-4,23,-3,23,-2,23,-1,23,-1,22,0,22,1,21,1,21,2,21,3,21,4,21,5,20,5,20,6,20,7,20,7,20,8,20,9,19,10,19,11,19,12,19,12,19,13,18,14,18,15,19,15,20,17,18,17,18,18,18,19,19,20,19,21,20,22,20,22,21,22,21,22,22,22,23,22,23,22,23,22,24,23,25,23,26,23,27,22,28,22,29,21,29,20,30,19,31,18,33,16,33,14,34,14,35,3,8,0,0,0,0,0,0,-1,-1,0,0,0,0,-1,-1,-1,-1,-1,-1,-3,-11,-12,-40,-11,-39,-10,-39,-10,-39,-8,-38,-7,-38,-7,-37,-7,-37,-6,-36,-5,-36,-5,-35,-4,-34,-4,-34,-4,-33,-4,-32,-5,-31,-5,-30,-5,-30,-5,-29,-5,-28,-6,-27,-6,-27,-7,-26,-7,-25,-8,-24,-8,-24,-8,-23,-10,-22,-11,-21,-11,-21,-11,-20,-12,-20,-13,-19,-14,-18,-14,-17,-15,-17,-15,-17,-16,-16,-16,-15,-17,-14,-17,-14,-18,-13,-18,-13,-19,-12,-20,-12,-21,-12,-22,-11,-22,-10,-22,-9,-23,-9,-24,-9,-24,-8,-24,-8,-25,-8,-26,-7,-26,-7,-26,-7,-4,-1]
    ```

### Step 3: Run analysis_csi_data.py in Python IDE

1. The main function **amplitude_cal** is used for calculating csi amplitude and plot CSI waveform.
2. The main function **visualize** is used for visualizing csi amplitudes in 3_Dimension.
3. The main function **image_render** is used for rendering csi amplitude as a batch of images.

You can select multiple csv files to analysis csi data.

## Related folder description

1. The example can be found in the [reference_data](./reference_data). It has both txt files and csv files available.
2. The indoor positioning example can be found in the [localization](./localization). It has two standing positions and an unobstructed empty environment used for distinguishing the difference between csi data on different positions.
